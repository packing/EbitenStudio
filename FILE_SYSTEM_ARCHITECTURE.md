# UIè®¾è®¡å™¨æ–‡ä»¶ç³»ç»Ÿæ¶æ„

## æ¦‚è¿°

ç³»ç»Ÿæ”¯æŒä¸¤ç§æ–‡ä»¶æ“ä½œæ¨¡å¼ï¼š
1. **é¡¹ç›®ä¿å­˜/æ‰“å¼€** (.ebiten) - ç”¨äºè®¾è®¡è¿‡ç¨‹ä¸­çš„ä¿å­˜å’Œç»§ç»­ç¼–è¾‘
2. **UIå¯¼å‡º** (.ui + .pak) - ç”¨äºæœ€ç»ˆæ‰“åŒ…å’Œè¿è¡Œæ—¶åŠ è½½

## æ–‡ä»¶ç±»å‹

### 1. é¡¹ç›®æ–‡ä»¶ (.ebiten)
**ç”¨é€”**: ä¿å­˜è®¾è®¡ä¸­çš„UIé¡¹ç›®ï¼ŒåŒ…å«èµ„æºçš„ç¡¬ç›˜è·¯å¾„å¼•ç”¨

**æ ¼å¼**: JSON
```json
{
  "version": "1.0",
  "canvas": {
    "width": 1280,
    "height": 720
  },
  "widgets": [...],
  "resources": {
    "images": [
      {
        "id": "img_001",
        "name": "èƒŒæ™¯å›¾",
        "path": "C:\\Users\\...\\background.png",
        "data": "base64..." // å¯é€‰çš„ç¼“å­˜æ•°æ®
      }
    ],
    "fonts": [...]
  }
}
```

**ç‰¹ç‚¹**:
- åŒ…å«èµ„æºçš„**ç»å¯¹è·¯å¾„**
- æ–¹ä¾¿é‡æ–°ç¼–è¾‘å’Œä¿®æ”¹
- å¯ä»¥æ·»åŠ /åˆ é™¤èµ„æº
- æ–‡ä»¶ä½“ç§¯å°ï¼ˆä¸åµŒå…¥èµ„æºæ•°æ®ï¼‰

### 2. UIæ–‡ä»¶ (.ui)
**ç”¨é€”**: æœ€ç»ˆçš„UIå®šä¹‰æ–‡ä»¶ï¼Œä¾›è¿è¡Œæ—¶åŠ è½½

**æ ¼å¼**: JSON
```json
{
  "name": "UI Layout",
  "version": 1,
  "width": 1280,
  "height": 720,
  "resourcePackHash": "a1b2c3d4...",
  "resourceManifest": {
    "version": 1,
    "count": 5,
    "resources": [
      {
        "id": "img_001",
        "name": "èƒŒæ™¯å›¾",
        "type": "image",
        "offset": 0,
        "size": 102400
      }
    ]
  },
  "widgets": [
    {
      "id": "button_1",
      "type": "button",
      "backgroundResourceNormal": "img_001",  // åªè®°å½•èµ„æºID
      ...
    }
  ]
}
```

**ç‰¹ç‚¹**:
- **ä¸åŒ…å«èµ„æºè·¯å¾„**ï¼Œåªæœ‰èµ„æºID
- åŒ…å«èµ„æºåŒ…çš„hashæ ¡éªŒ
- åŒ…å«èµ„æºæ¸…å•ï¼ˆmanifestï¼‰
- ä¸.pakæ–‡ä»¶é…å¯¹ä½¿ç”¨

### 3. èµ„æºåŒ…æ–‡ä»¶ (.pak)
**ç”¨é€”**: æ‰“åŒ…æ‰€æœ‰UIä½¿ç”¨çš„èµ„æºï¼ˆå›¾ç‰‡ã€å­—ä½“ç­‰ï¼‰

**æ ¼å¼**: äºŒè¿›åˆ¶
```
[èµ„æº1æ•°æ®][èµ„æº2æ•°æ®][èµ„æº3æ•°æ®]...
```

**å‘½åè§„åˆ™**: `<basename>_<hashå‰8ä½>.pak`
ä¾‹å¦‚: `ui_layout_a1b2c3d4.pak`

**ç‰¹ç‚¹**:
- æ‰€æœ‰èµ„æºè¿ç»­å­˜å‚¨
- é€šè¿‡manifestä¸­çš„offsetå’Œsizeå®šä½
- ä½¿ç”¨SHA-256 hashæ ¡éªŒå®Œæ•´æ€§

## å·¥ä½œæµç¨‹

### è®¾è®¡é˜¶æ®µ

```
1. æ–°å»ºé¡¹ç›®
   â†“
2. æ·»åŠ UIæ§ä»¶
   â†“
3. æ·»åŠ èµ„æºï¼ˆå›¾ç‰‡ç­‰ï¼‰ â†’ è®°å½•ç¡¬ç›˜è·¯å¾„
   â†“
4. ä¿å­˜é¡¹ç›® (.ebiten) â†’ åŒ…å«èµ„æºè·¯å¾„å¼•ç”¨
   â†“
5. ç»§ç»­ç¼–è¾‘...
```

### å¯¼å‡ºå‘å¸ƒ

```
1. å®Œæˆè®¾è®¡
   â†“
2. ç‚¹å‡»"å¯¼å‡º"æŒ‰é’®
   â†“
3. æ‰“åŒ…æ‰€æœ‰èµ„æº
   â”œâ”€ è¯»å–èµ„æºæ–‡ä»¶
   â”œâ”€ åˆå¹¶ä¸ºpakæ–‡ä»¶
   â””â”€ è®¡ç®—hash
   â†“
4. ç”ŸæˆUIæ–‡ä»¶
   â”œâ”€ åŒ…å«èµ„æºæ¸…å•
   â”œâ”€ åŒ…å«hash
   â””â”€ æ§ä»¶åªå¼•ç”¨èµ„æºID
   â†“
5. è¾“å‡ºæ–‡ä»¶
   â”œâ”€ ui_layout.ui
   â””â”€ ui_layout_a1b2c3d4.pak
```

### è¿è¡Œæ—¶åŠ è½½

```
Viewerå¯åŠ¨
  â†“
1. è¯»å–.uiæ–‡ä»¶
  â†“
2. è§£æresourcePackHashå’Œmanifest
  â†“
3. æŸ¥æ‰¾å¯¹åº”çš„.pakæ–‡ä»¶
   â””â”€ æ–‡ä»¶ååŒ¹é…: *_<hashå‰8ä½>.pak
  â†“
4. éªŒè¯pakæ–‡ä»¶hash
   â”œâ”€ åŒ¹é… â†’ ç»§ç»­
   â””â”€ ä¸åŒ¹é… â†’ æŠ¥é”™ï¼ˆèµ„æºåŒ…æŸåæˆ–ä¸åŒ¹é…ï¼‰
  â†“
5. æ ¹æ®manifestè§£åŒ…èµ„æº
   â””â”€ è¯»å–æ¯ä¸ªèµ„æºçš„offsetå’Œsize
  â†“
6. æ¸²æŸ“UI
   â””â”€ æ§ä»¶å¼•ç”¨èµ„æºIDï¼Œä»å·²è§£åŒ…èµ„æºä¸­æŸ¥æ‰¾
```

## èµ„æºæ‰“åŒ…ç®—æ³•

### æ‰“åŒ…æ­¥éª¤

1. **æ”¶é›†èµ„æº**
   ```javascript
   const resources = [
     { id: 'img_001', path: '...', type: 'image' },
     { id: 'img_002', path: '...', type: 'image' }
   ];
   ```

2. **è¯»å–èµ„æºæ•°æ®**
   ```javascript
   for (const resource of resources) {
     const data = await readFile(resource.path);
     resourceBlocks.push(data);
   }
   ```

3. **æ„å»ºæ¸…å•**
   ```javascript
   let offset = 0;
   for (const resource of resources) {
     manifest.resources.push({
       id: resource.id,
       offset: offset,
       size: resource.size
     });
     offset += resource.size;
   }
   ```

4. **åˆå¹¶æ•°æ®**
   ```javascript
   const pakData = mergeArrayBuffers(resourceBlocks);
   ```

5. **è®¡ç®—hash**
   ```javascript
   const hash = await crypto.subtle.digest('SHA-256', pakData);
   ```

### è§£åŒ…æ­¥éª¤

1. **è¯»å–pakæ–‡ä»¶**
   ```go
   pakData, err := os.ReadFile("ui_layout_a1b2c3d4.pak")
   ```

2. **éªŒè¯hash**
   ```go
   actualHash := sha256.Sum256(pakData)
   if actualHash != expectedHash {
       return ErrHashMismatch
   }
   ```

3. **æå–èµ„æº**
   ```go
   for _, resourceInfo := range manifest.Resources {
       data := pakData[resourceInfo.Offset : resourceInfo.Offset+resourceInfo.Size]
       resources[resourceInfo.ID] = data
   }
   ```

## æŒ‰é’®åŠŸèƒ½è¯´æ˜

### ä¿å­˜æŒ‰é’®ï¼ˆCtrl+Sï¼‰
- **æ–‡ä»¶ç±»å‹**: .ebitenï¼ˆé¡¹ç›®æ–‡ä»¶ï¼‰
- **åŒ…å«å†…å®¹**: UIè®¾è®¡ + èµ„æºè·¯å¾„å¼•ç”¨
- **ä½¿ç”¨åœºæ™¯**: ä¿å­˜è®¾è®¡è¿›åº¦ï¼Œç¨åç»§ç»­ç¼–è¾‘

### å¯¼å‡ºæŒ‰é’®ï¼ˆğŸ’¾ï¼‰
- **æ–‡ä»¶ç±»å‹**: .ui + .pakï¼ˆUIåŒ…ï¼‰
- **åŒ…å«å†…å®¹**: UIå®šä¹‰ + æ‰“åŒ…çš„èµ„æºæ–‡ä»¶
- **ä½¿ç”¨åœºæ™¯**: æœ€ç»ˆå‘å¸ƒï¼Œä¾›vieweræˆ–æ¸¸æˆåŠ è½½

### é¢„è§ˆæŒ‰é’®ï¼ˆâ–¶ï¸ï¼‰
- **åŠŸèƒ½**: ä¸´æ—¶ç”ŸæˆåŒ…å«è·¯å¾„çš„JSONï¼Œå¯åŠ¨vieweré¢„è§ˆ
- **ä¸ä¿å­˜æ–‡ä»¶**: ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ï¼Œé¢„è§ˆåè‡ªåŠ¨æ¸…ç†

## ä¼˜åŠ¿

### å¼€å‘é˜¶æ®µ
- âœ… å¿«é€Ÿä¿å­˜/åŠ è½½ï¼ˆå°æ–‡ä»¶ï¼‰
- âœ… çµæ´»ä¿®æ”¹èµ„æºï¼ˆæ›´æ¢å›¾ç‰‡ï¼‰
- âœ… ç‰ˆæœ¬æ§åˆ¶å‹å¥½ï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰
- âœ… èµ„æºè·¯å¾„æ¸…æ™°å¯è§

### å‘å¸ƒé˜¶æ®µ
- âœ… èµ„æºå®Œæ•´æ‰“åŒ…ï¼ˆæ— å¤–éƒ¨ä¾èµ–ï¼‰
- âœ… Hashæ ¡éªŒï¼ˆé˜²ç¯¡æ”¹ï¼‰
- âœ… åŠ è½½é«˜æ•ˆï¼ˆè¿ç»­è¯»å–ï¼‰
- âœ… æ–‡ä»¶æ•´æ´ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰

## æ–‡ä»¶å‘½åå»ºè®®

### é¡¹ç›®æ–‡ä»¶
```
my_ui_project.ebiten
login_screen.ebiten
game_hud.ebiten
```

### å¯¼å‡ºæ–‡ä»¶
```
login_screen.ui + login_screen_a1b2c3d4.pak
game_hud.ui + game_hud_f5e6d7c8.pak
```

## æ³¨æ„äº‹é¡¹

1. **èµ„æºè·¯å¾„**
   - é¡¹ç›®æ–‡ä»¶ä¸­çš„èµ„æºè·¯å¾„æ˜¯ç»å¯¹è·¯å¾„
   - è·¨æœºå™¨æ—¶éœ€è¦é‡æ–°å®šä½èµ„æº

2. **HashåŒ¹é…**
   - .uiæ–‡ä»¶å’Œ.pakæ–‡ä»¶å¿…é¡»é…å¯¹
   - Hashä¸åŒ¹é…æ—¶viewerä¼šæ‹’ç»åŠ è½½

3. **èµ„æºID**
   - èµ„æºIDå¿…é¡»å”¯ä¸€
   - å¯¼å‡ºæ—¶ä¿æŒIDä¸€è‡´æ€§

4. **æ–‡ä»¶åˆ†å‘**
   - å‘å¸ƒUIæ—¶å¿…é¡»åŒæ—¶åŒ…å«.uiå’Œ.pakæ–‡ä»¶
   - å»ºè®®æ‰“åŒ…ä¸ºzipåˆ†å‘

## æœªæ¥æ”¹è¿›

- ğŸ”„ å¢é‡æ‰“åŒ…ï¼ˆåªæ‰“åŒ…ä¿®æ”¹çš„èµ„æºï¼‰
- ğŸ—œï¸ èµ„æºå‹ç¼©ï¼ˆå‡å°pakæ–‡ä»¶ä½“ç§¯ï¼‰
- ğŸ” èµ„æºåŠ å¯†ï¼ˆä¿æŠ¤èµ„äº§ï¼‰
- ğŸ“¦ æ‰¹é‡å¯¼å‡ºï¼ˆå¤šä¸ªUIä¸€æ¬¡æ€§å¯¼å‡ºï¼‰
- ğŸ” èµ„æºå¼•ç”¨æ£€æŸ¥ï¼ˆæœªä½¿ç”¨çš„èµ„æºæç¤ºï¼‰
